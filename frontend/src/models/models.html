<div class="models">
  <div>
    <div class="flex grow flex-col gap-y-5 overflow-y-auto border-r border-gray-200 bg-white px-2 h-[calc(100vh-55px)]">
      <div class="flex font-bold font-xl mt-4 pl-2">
        Models
      </div>
      <nav class="flex flex-1 flex-col">
        <ul role="list" class="flex flex-1 flex-col gap-y-7">
          <li>
            <ul role="list">
              <li v-for="model in models">
                <router-link
                  :to="'/model/' + model"
                  class="block rounded-md py-2 pr-2 pl-2 text-sm font-semibold text-gray-700"
                  :class="model === currentModel ? 'bg-puerto-rico-100 font-bold' : 'hover:bg-puerto-rico-100'">
                  {{model}}
                </router-link>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
    </div>
    
  </div>
  <div class="documents" ref="documentsList">
    <div>
      <div class="documents-menu">
        <div class="search-input">
          <form @submit.prevent="search">
            <input class="search-text" type="text" placeholder="Filter or text" v-model="searchText" />
          </form>
        </div>
        <div class="buttons">
          <div class="mr-2">
            <span v-if="status === 'loading'">Loading ...</span>
            <span v-if="status === 'loaded'">{{numDocuments === 1 ? numDocuments+ ' document' : numDocuments + ' documents'}}</span>
          </div>
          <button
            @click="shouldShowExportModal = true"
            type="button"
            class="mr-2 rounded bg-puerto-rico-600 px-2 py-1 text-sm font-semibold text-white shadow-sm hover:bg-puerto-rico-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-puerto-rico-600">
            Export
          </button>
          <button
            @click="shouldShowFieldModal = true"
            type="button"
            class="rounded bg-puerto-rico-600 px-2 py-1 text-sm font-semibold text-white shadow-sm hover:bg-puerto-rico-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-puerto-rico-600">
            Fields
          </button>
        </div>
      </div>
    </div>
    <div class="documents-container">
      <table>
        <thead>
          <th v-for="path in filteredPaths">
            {{path.path}}
            <span class="path-type">
              ({{(path.instance || 'unknown')}})
            </span>
            <span class="sort-arrow" @click="sortDocs(1, path.path)">{{sortBy[path.path] == 1 ? 'X' : '↑'}}</span>
            <span class="sort-arrow" @click="sortDocs(-1, path.path)">{{sortBy[path.path] == -1 ? 'X' : '↓'}}</span>
          </th>
        </thead>
        <tbody>
          <tr v-for="document in documents" @click="$router.push('/model/' + currentModel + '/document/' + document._id)" :key="document._id">
            <td v-for="schemaPath in filteredPaths">
              <component
                :is="getComponentForPath(schemaPath)"
                :value="getValueForPath(document, schemaPath.path)"
                :allude="getReferenceModel(schemaPath)">
              </component>
            </td>
          </tr>
        </tbody>
      </table>
      <div v-if="status === 'loading'" class="loader">
        <img src="images/loader.gif">
      </div>
    </div>
    <modal v-if="shouldShowExportModal">
      <template v-slot:body>
        <div class="modal-exit" @click="shouldShowExportModal = false">&times;</div>
        <export-query-results
          :schemaPaths="schemaPaths"
          :filter="filter"
          :currentModel="currentModel"
          @done="shouldShowExportModal = false">
        </export-query-results>
      </template>
    </modal>
    <modal v-if="shouldShowFieldModal">
      <template v-slot:body>
        <div class="modal-exit" @click="shouldShowFieldModal = false; selectedPaths = [...filteredPaths];">&times;</div>
        <div v-for="(path, index) in schemaPaths" :key="index" style="margin-bottom: 0.5em">
          <input type="checkbox" :id="'path.path'+index" @change="addOrRemove(path)" :value="path.path" :checked="isSelected(path.path)" />
          <label :for="'path' + index">{{path.path}}</label>
        </div>
        <div style="margin-top: 1em">
          <button type="submit" @click="filterDocuments()" style="color: black;margin-right: 0.5em">Filter Selection</button>
          <button type="submit" @click="deselectAll()" class="gray" style="margin-right: 0.5em">Deselect All</button>
          <button type="submit" @click="resetDocuments()" class="gray">Cancel</button>
          
        </div>
      </template>
    </modal>
  </div>
</div>