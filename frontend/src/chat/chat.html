<div class="flex" style="height: calc(100vh - 55px); height: calc(100dvh - 55px)">
  <div class="fixed top-[65px] cursor-pointer bg-gray-100 rounded-r-md z-10" @click="hideSidebar = false">
    <svg xmlns="http://www.w3.org/2000/svg" style="h-5 w-5" viewBox="0 -960 960 960" class="w-5" fill="#5f6368"><path d="M360-120v-720h80v720h-80Zm160-160v-400l200 200-200 200Z"/></svg>
  </div>
  <button
    class="fixed top-[65px] right-4 z-10 p-2 rounded-md shadow bg-white"
    :class="hasWorkspace ? 'text-gray-700 hover:bg-gray-100' : 'text-gray-300 cursor-not-allowed bg-gray-50'"
    @click="toggleShareThread"
    :disabled="!hasWorkspace || !chatThreadId || sharingThread"
    aria-label="Share thread"
  >
    <svg v-if="hasWorkspace" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7a2.48 2.48 0 0 0 0-1.39l7.02-4.11a2.5 2.5 0 1 0-.87-1.37L8.04 9.94a2.5 2.5 0 1 0 0 4.12l7.12 4.16a2.5 2.5 0 1 0 .84-1.34l-7.05-4.12c-.04-.02-.08-.05-.11-.07a2.48 2.48 0 0 0 0-1.39c.03-.02.07-.04.11-.07l7.11-4.16c.52.47 1.2.76 1.94.76a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0-1.94.94L7.97 8.43a2.5 2.5 0 1 0 0 7.14l9.09 5.3c.52-.47 1.2-.76 1.94-.76a2.5 2.5 0 1 0 0-5z"/></svg>
    <svg v-else xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 1a5 5 0 00-5 5v3H6a2 2 0 00-2 2v9a2 2 0 002 2h12a2 2 0 002-2v-9a2 2 0 00-2-2h-1V6a5 5 0 00-5-5zm-3 8V6a3 3 0 016 0v3H9zm9 2v9H6v-9h12z"/></svg>
  </button>
  <!-- Sidebar: Chat Threads -->
  <aside class="bg-gray-50 border-r overflow-y-auto overflow-x-hidden h-full transition-all duration-300 ease-in-out z-20 w-0 lg:w-64 fixed lg:relative" :class="hideSidebar === true ? '!w-0' : hideSidebar === false ? '!w-64' : ''">
    <div class="flex items-center border-b border-gray-100 w-64 overflow-x-hidden">
      <div class="p-4 font-bold text-lg">Chat Threads</div>
      <button
        @click="hideSidebar = true"
        class="ml-auto mr-2 p-2 rounded hover:bg-gray-200 focus:outline-none"
        aria-label="Close sidebar"
      >
        <svg xmlns="http://www.w3.org/2000/svg" style="h-5 w-5" viewBox="0 -960 960 960" class="w-5" fill="currentColor"><path d="M660-320v-320L500-480l160 160ZM200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm120-80v-560H200v560h120Zm80 0h360v-560H400v560Zm-80 0H200h120Z"/></svg>
      </button>
    </div>
    <div class="p-4 w-64">
      <async-button
        @click="createNewThread"
        class="w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
      >
        Create New Thread
      </async-button>
    </div>
    <div v-if="status === 'loaded' && chatThreads.length === 0" class="p-4 text-sm text-gray-700">
      No threads yet
    </div>
    <ul v-if="status === 'loaded'" class="w-64">
      <li
        v-for="thread in chatThreads"
        :key="thread._id"
        @click="selectThread(thread._id)"
        class="p-4 hover:bg-gray-200 cursor-pointer w-64"
        :class="{ 'bg-gray-300': thread._id === chatThreadId }"
      >
        {{ thread.title || 'Untitled Thread' }}
      </li>
    </ul>
  </aside>

  <!-- Main Chat Area -->
  <main class="flex-1 flex flex-col">
    <div class="flex-1 overflow-y-auto p-6 space-y-4" ref="messagesContainer">
      <ul role="list" class="space-y-4">
        <div v-if="true">
          <div class="flex items-center justify-center py-3 mb-4">
            <div class="bg-gray-300 h-px flex-grow max-w-xs"></div>
            <p class="mx-4 text-sm font-medium text-gray-500">This is the beginning of the message thread</p>
            <div class="bg-gray-300 h-px flex-grow max-w-xs"></div>
          </div>
        </div>
        <li v-for="message in chatMessages" :key="message._id">
          <chat-message :message="message"></chat-message>
        </li>
      </ul>
    </div>


    <!-- Input Area -->
    <div class="border-t p-4">
      <form @submit.prevent="sendMessage" :disabled="sendingMessage" class="flex gap-2 items-end justify-end">
        <textarea
          v-model="newMessage"
          placeholder="Ask something..."
          class="flex-1 border rounded px-4 py-2 resize-none overflow-y-auto"
          rows="1"
          ref="messageInput"
          @input="adjustTextareaHeight"
          @keydown.enter.exact.prevent="handleEnter"
        ></textarea>
        <button class="bg-blue-600 text-white px-4 h-[42px] rounded disabled:bg-gray-600" :disabled="sendingMessage">
          <svg v-if="sendingMessage" style="height: 1em" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <g>
              <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2" opacity="0.3" />
              <path d="M12 2a10 10 0 0 1 10 10" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                <animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" dur="1s" repeatCount="indefinite" />
              </path>
            </g>
          </svg>
          <span v-else>Send</span>
        </button>
      </form>
    </div>
  </main>
</div>
